<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Landing Page</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet"
    type="text/css">

  <!-- Custom styles for this template -->
  <link href="css/landing-page.min.css" rel="stylesheet">

  <!-- axios -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>

  <!-- Navigation -->
  <div class="container">


    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Navbar</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>

        </ul>
      </div>

      <!-- to disappear when logged in -->

      <div class="row " id="log">

      </div>


    </nav>

  </div>

  <!-- Masthead -->
  <header class="masthead text-white text-center" id="header">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-xl-9 mx-auto">
          <h1 class="mb-5">To use our services, Sign Up Now!</h1>
        </div>
        <div class="col-md-10 col-lg-8 col-xl-7 mx-auto">

          <div class="form-row">



            <button class="btn btn-primary btn-block" style="text-align: center;" data-toggle="modal"
              data-target="#signupmodal">Sign Up</button>

          </div>

        </div>
      </div>
    </div>

  </header>

  <div class="modal fade" id="signupmodal" tabindex="-1" role="dialog" aria-labelledby="signupmodalTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="signupmodalLongTitle"> Sign Up</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="signupForm">
            <div class="form-group">

              <label for="signup_username">Username</label>
              <input type="text" class="form-control" id="signup_username" required placeholder="Enter Username">
            </div>
            <div class="form-group">
              <label for="signup_email">Email</label>
              <input type="email" class="form-control" id="signup_email" required placeholder="Enter Email">
            </div>
            <div class="form-group">
              <label for="signup_password">Password</label>
              <input type="password" class="form-control" id="signup_password" required placeholder="Enter Password">
            </div>


            <div class="form-group">

              <label for="signup_address">Address</label>
              <input type="text" class="form-control" id="signup_address" required placeholder="Enter Address">
            </div>

            <div class="form-group">

              <label for="signup_companyName">Company Name</label>
              <input type="text" class="form-control" id="signup_companyName" required placeholder="Enter Company Name">
            </div>

            <div class="form-group">

              <label for="signup_fullName">Full Name</label>
              <input type="text" class="form-control" id="signup_fullName" required placeholder="Enter Full Name">
            </div>

            <div class="form-group">

              <label for="signup_phoneNumber">Phone Number</label>
              <input type="text" class="form-control" id="signup_phoneNumber" required placeholder="Enter Phone Number">
            </div>



            <div class="form-group">

              <label for="signup_position">Position</label>
              <input type="text" class="form-control" id="signup_position" required placeholder="Enter Position">
            </div>


            <div class="form-group">

              <label for="signup_uen">UEN</label>
              <input type="text" class="form-control" id="signup_uen" required placeholder="Enter UEN">
            </div>



            <div class="form-group text-center">
              <button id="signup_button" type="submit" style="text-align: center;" class="btn btn-orange btn-block"
                onclick="signUp()">Sign
                Up</button>
            </div>
          </form>
        </div>
        <div class="modal-footer">

        </div>
      </div>
    </div>
  </div>




  <!-- Icons Grid -->
  <section class="features-icons bg-light text-center">
    <div class="container">
      <div class="row" id="page-links">

      </div>

    </div>
  </section>


  <footer class="footer bg-light">
    <div class="container">
      <div class="row">
        <div class="col-lg-6 h-100 text-center text-lg-left my-auto">
          <ul class="list-inline mb-2">
            <li class="list-inline-item">
              <a href="#">About</a>
            </li>
            <li class="list-inline-item">&sdot;</li>
            <li class="list-inline-item">
              <a href="#">Contact</a>
            </li>
            <li class="list-inline-item">&sdot;</li>
            <li class="list-inline-item">
              <a href="#">Terms of Use</a>
            </li>
            <li class="list-inline-item">&sdot;</li>
            <li class="list-inline-item">
              <a href="#">Privacy Policy</a>
            </li>
          </ul>
          <p class="text-muted small mb-4 mb-lg-0">&copy; Antzbuildz 2021. All Rights Reserved.</p>
        </div>
        <div class="col-lg-6 h-100 text-center text-lg-right my-auto">
          <ul class="list-inline mb-0">
            <li class="list-inline-item mr-3">
              <a href="#">
                <i class="fab fa-facebook fa-2x fa-fw"></i>
              </a>
            </li>
            <li class="list-inline-item mr-3">
              <a href="#">
                <i class="fab fa-twitter-square fa-2x fa-fw"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a href="#">
                <i class="fab fa-instagram fa-2x fa-fw"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // console.log(sessionStorage.getItem("username") != null)
    if (sessionStorage.getItem("username") != null) {

      // document.getElementById("log").remove()

      document.getElementById("log").insertAdjacentHTML('afterBegin', `

      <div class="col" >
        <a class="navbar-brand" id="userlogin">Navbar</a>
        </div>

        <div class="col">
          <a class="btn btn-primary" onclick="logoutfunction()" id="login" href="#"> Log Out</a>
        </div>` )

      document.getElementById("userlogin").innerHTML = "Username:" + sessionStorage.getItem("username");

      document.getElementById("header").remove()
    } else {

      document.getElementById("log").insertAdjacentHTML('afterBegin', `
      <div class="col-3">
        </div>
        <div class="col-3">
          <a><input type="text" class="form-control" id="email" placeholder="Username/Email"></a>
        </div>
        <div class="col-3">
          <a><input type="password" class="form-control" id="password" required placeholder="Password"></a>
        </div>
        <div class="col-3">
          <a class="btn btn-primary" onclick="loginfunction()" id="login" href="#"> Sign In</a>
        </div>`  )

    }


    // var admin = "user";
    // console.log(sessionStorage.getItem("ADMIN") == "ADMIN")
    if (sessionStorage.getItem("ADMIN") == "ADMIN") {



      document.getElementById("page-links").insertAdjacentHTML('afterBegin', `  
 
      <div class="col-lg-3" onclick="location.href='Admin.html';">
          <div class="features-icons-item mx-auto mb-0 mb-lg-3">
            <div class="features-icons-icon d-flex">
              <i class="icon-folder m-auto text-primary"></i>
            </div>
            <h3>Admin Page</h3>
            <p class="lead mb-0">View Admin Page</p>
          </div>
        </div>
        </div>
        
        <div class="col-lg-3" onclick="location.href='AdminCompleteBids.html';">
          <div class="features-icons-item mx-auto mb-0 mb-lg-3">
            <div class="features-icons-icon d-flex">
              <i class="icon-folder m-auto text-primary"></i>
            </div>
            <h3>Admin Complete Bids Page</h3>
            <p class="lead mb-0">Complete bids</p>
          </div>
        </div>
        </div>
        
        
        
        
        
        ` 
        
        
        
        
        
        )
    }
    // console.log(sessionStorage.getItem("USER") == "USER")
    //  console.log(sessionStorage.getItem("userId"))
    if (sessionStorage.getItem("USER") == "USER") {

      document.getElementById("page-links").insertAdjacentHTML('afterBegin', `  
        <div class="col-lg-3" onclick="location.href='Request.html';">
          <div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
            <div class="features-icons-icon d-flex">
              <i class="icon-screen-desktop m-auto text-primary"></i>
            </div>
            <h3>Request</h3>
            <p class="lead mb-0">Make a logistic request</p>
          </div>
        </div>
            <div class="col-lg-3" onclick="location.href='viewcurrentbids.html';">
          <div class="features-icons-item mx-auto mb-0 mb-lg-3">
            <div class="features-icons-icon d-flex">
              <i class="icon-folder m-auto text-primary"></i>
            </div>
            <h3>View Current Request</h3>
            <p class="lead mb-0">View Current Bids</p>
          </div>
        </div>

      ` )


    }

    if (sessionStorage.getItem("PARTNER") == "PARTNER") {

      document.getElementById("page-links").insertAdjacentHTML('afterBegin', `  
          <div class="col-lg-3"  onclick="location.href='RequestToBid.html';">
          <div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
            <div class="features-icons-icon d-flex">
              <i class="icon-wallet m-auto text-primary"></i>
            </div>
            <h3>Bids</h3>
            <p class="lead mb-0">Place Bid for Request</p>
          </div>
        </div>

        <div class="col-lg-3"  onclick="location.href='AddResources.html';">
          <div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
            <div class="features-icons-icon d-flex">
              <i class="icon-notebook m-auto text-primary"></i>
            </div>
            <h3>Resources</h3>
            <p class="lead mb-0">Add and View Resources</p>
          </div>
        </div>
        <div class="col-lg-3"  onclick="location.href='view Requests.html';">
          <div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
            <div class="features-icons-icon d-flex">
              <i class="icon-wallet m-auto text-primary"></i>
            </div>
            <h3>View Request</h3>
            <p class="lead mb-0">View Request to bid</p>
          </div>
        </div>

      ` )

    }


    if (sessionStorage.getItem("partnerRequest") == 'false' && sessionStorage.getItem("PARTNER")== null) {

      document.getElementById("page-links").insertAdjacentHTML('afterBegin', `  
    <div class="col-lg-3"  onclick="requestPartner()">
    <div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
      <div class="features-icons-icon d-flex">
        <i class="icon-envelope-open m-auto text-primary"></i>
      </div>
      <h3>Partner Request</h3>
      <p class="lead mb-0">Request to be Partner</p>
    </div>
  </div>


` )

    }
// console.log(sessionStorage.getItem("PARTNER"))

    if (sessionStorage.getItem("partnerRequest") == 'true' && sessionStorage.getItem("PARTNER") == null) {

      document.getElementById("page-links").insertAdjacentHTML('afterBegin', `  
<div class="col-lg-3" >
<div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
<div class="features-icons-icon d-flex">
  <i class="icon-envelope-letter m-auto text-primary"></i>
</div>
<h3>Partner Requested</h3>
<p class="lead mb-0">Pending request to be Partner</p>
</div>
</div>


` )

    }
    // else {
    //   document.getElementById("page-links").insertAdjacentHTML('afterBegin', `  <div class="row">
    //     <div class="col-lg-3" onclick="location.href='Request.html';">
    //       <div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
    //         <div class="features-icons-icon d-flex">
    //           <i class="icon-screen-desktop m-auto text-primary"></i>
    //         </div>
    //         <h3>Request</h3>
    //         <p class="lead mb-0">Make a logistic request</p>
    //       </div>
    //     </div>
    //     <div class="col-lg-3"  onclick="location.href='Bids.html';">
    //       <div class="features-icons-item mx-auto mb-5 mb-lg-0 mb-lg-3">
    //         <div class="features-icons-icon d-flex">
    //           <i class="icon-wallet m-auto text-primary"></i>
    //         </div>
    //         <h3>Bids</h3>
    //         <p class="lead mb-0">Place Bid for Request</p>
    //       </div>
    //     </div>
    //     <div class="col-lg-3">
    //       <div class="features-icons-item mx-auto mb-0 mb-lg-3">
    //         <div class="features-icons-icon d-flex">
    //           <i class="icon-folder m-auto text-primary"></i>
    //         </div>
    //         <h3>View Historical Bids</h3>
    //         <p class="lead mb-0">View Historical Bids</p>
    //       </div>
    //     </div>
    //     <div class="col-lg-3">
    //       <div class="features-icons-item mx-auto mb-0 mb-lg-3">
    //         <div class="features-icons-icon d-flex">
    //           <i class="icon-folder m-auto text-primary"></i>
    //         </div>
    //         <h3>Admin Page</h3>
    //         <p class="lead mb-0">View Historical Bids</p>
    //       </div>
    //     </div>
    //   </div>` )

    // }
  </script>

  <script>
  

    function requestPartner() {
      userId = sessionStorage.getItem('userId')

      var config = {
        method: 'get',
        url: 'http://localhost:8710/user/api/requestPartner/' +userId ,
        headers: {
          'Content-Type': 'application/json',
          "Authorization": "Bearer " + sessionStorage.getItem("accessToken")
        },
  
      };

      axios(config)
      .then(response =>{
        if (response.status == 200){
          alert("successfully requested to be a partner")


          
          var nextconfig = {
            method: 'get',
            url: 'http://localhost:8710/user/api/verifyPartnerRequest/' + userId,
            headers: {
              'Content-Type': 'application/json',
              "Authorization": "Bearer " + sessionStorage.getItem("accessToken")
            },
        
          };

          axios(nextconfig)
            .then(response => {
              // console.log(response)


              var partnerRequest = (response.data)
              sessionStorage.setItem('partnerRequest', partnerRequest);
              location.reload()

              // console.log(sessionStorage.getItem('partnerRequest'))
            })


        
        }

      
      })

      .catch(error =>{
        alert(error)
      })
    }




    // console.log(sessionStorage.getItem("username"))


    function loginfunction() {
      var loginid = document.getElementById("email").value;
      var password = document.getElementById("password").value;
      var data = JSON.stringify({ "password": password, "username": loginid });
      // console.log(data)
      var config = {
        method: 'post',
        url: 'http://localhost:8710/api/login',
        headers: {
          'Content-Type': 'application/json'
        },
        data: data
      };




      axios(config)
        .then(response => {
          console.log(response)
     
          var credentials = JSON.parse(atob(JSON.stringify(response.data).split('.')[1]));

          // console.log(response)
          // console.log(response.data.accessToken)

          var userId = credentials.userId;
          // console.log(response);
          sessionStorage.setItem('accessToken', response.data.accessToken)


          sessionStorage.setItem('userId', userId);
          var username = credentials.sub;
          // console.log(username);

          var auth = credentials.auth;

          //auth is an array

          if (auth.includes('ROLE_USER')) {
            sessionStorage.setItem('USER', 'USER');
          }

          if (auth.includes('ROLE_ADMIN')) {
            sessionStorage.setItem('ADMIN', 'ADMIN');
          }
          if (auth.includes('ROLE_PARTNER')) {
            sessionStorage.setItem('PARTNER', 'PARTNER');
          }

          sessionStorage.setItem('username', username);
          // console.log(sessionStorage.getItem("username"))

          // console.log(  sessionStorage.getItem('PARTNER'))
 


          var nextconfig = {
            method: 'get',
            url: 'http://localhost:8710/user/api/verifyPartnerRequest/' + userId,
            headers: {
              'Content-Type': 'application/json',
              "Authorization": "Bearer " + sessionStorage.getItem("accessToken")
            },
            data: data
          };

          axios(nextconfig)
            .then(response => {
        


              var partnerRequest = (response.data)
              sessionStorage.setItem('partnerRequest', partnerRequest);

              console.log(sessionStorage.getItem('partnerRequest'))
              window.location.href = "index.html";
            })



        })
        .catch(error => console.log(error));

      // .catch(error => alert("Incorrect Login Credentials."));

    };

    function logoutfunction() {
      sessionStorage.clear();
      window.location.href = "index.html";
    }


    document.getElementById("signup_button").addEventListener("click", function (event) {
      event.preventDefault()
    });



    function signUp() {
      event.preventDefault()


      signup_username = document.getElementById("signup_username").value
      signup_email = document.getElementById("signup_email").value
      signup_password = document.getElementById("signup_password").value
      signup_uen = document.getElementById("signup_uen").value
      signup_position = document.getElementById("signup_position").value
      signup_phoneNumber = document.getElementById("signup_phoneNumber").value
      signup_fullName = document.getElementById("signup_fullName").value
      signup_companyName = document.getElementById("signup_companyName").value
      signup_address = document.getElementById("signup_address").value

      var signup_error = [];
      if (signup_username.length <= 0) {
        signup_error.push("Please fill in username")

      }

      if (signup_email.length <= 0 && signup_email.conta) {
        signup_error.push("Please fill in username")

      }


      var data = JSON.stringify({
        "address": signup_address,
        "companyName": signup_companyName,
        "email": signup_email,
        "fullName": signup_fullName,
        "password": signup_password,
        "phoneNumber": signup_phoneNumber,
        "position": signup_position,
        "uen": signup_uen,
        "username": signup_username
      });




      var config = {
        method: 'post',
        url: 'http://localhost:8710/user/api/create',
        headers: {
          'Content-Type': 'application/json'
        },
        data: data
      };


      axios(config)
        .then(response => {

          alert(response.data)
          // location.reload();





        })
        .catch(error => alert("Ensure all fields are correct"));




    }








  </script>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>


</body>

</html>